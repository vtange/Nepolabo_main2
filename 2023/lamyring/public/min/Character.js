function Character(e,r,a,t,i){if(-1!==t.arrCharNames.indexOf(e))throw new Error("Character with name "+e+" already exists.");this.name=e,this.fernScene=r,this.oManifestEntry=a,this.wrapperNode=new BABYLON.TransformNode(e+"_tfNode"),this.addFacingTfNode();var n=t.arrCharNames.length?t.newCharOrMeshInstance(e):t;t.arrCharNames.push(e),this.root=n.root,this.root.parent=this.wrapperNode,this.faceMaterial=n.facemat,this.oAnims=n.anims,this.currentTranslation=null,this.pubsubForAnimationGroups(n.anims,a,n.isClone),i&&Promise.all(i).then(function(e){this.processFaceTextures(e[0])}.bind(this))}Character.prototype.pubsubForAnimationGroups=function(e,r,a){var t=null,i=a?"":this.name+"_";for(var n in e)PubSub.subscribe(i+n,e[n].bind(null)),t||n!=r.idleAnim&&-1===n.indexOf("idle_")||(t=n);t&&PubSub.publish(i+t)},Character.prototype.processFaceTextures=function(e){var r=this.faceMaterial,a=!0;if(r)for(var t in e)"close_eyes"==t&&window.setInterval(function(t){if(a){var i=r.albedoTexture;r.albedoTexture=e[t],window.setTimeout((function(){r.albedoTexture=i}),100)}}.bind(null,t),3e3),PubSub.subscribe(this.name+"_face_"+t,(function(){a=!1,r.albedoTexture=e[t]}))},Character.prototype.addFacingTfNode=function(){var e=this.facingNode=new BABYLON.TransformNode("_directionFacingNode_"+this.name);e.position.x=0,e.position.y=0,e.position.z=.6,e.parent=this.wrapperNode},Character.prototype.toggleHoverWobble=function(){var e=new BABYLON.Animation("floatAnim","position.y",60,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),r=[];r.push({frame:0,value:0}),r.push({frame:10,value:.001}),r.push({frame:80,value:this.oManifestEntry.hoverWobble}),r.push({frame:100,value:this.oManifestEntry.hoverWobble}),r.push({frame:170,value:.001}),r.push({frame:180,value:0}),e.setKeys(r),this.fernScene.self.beginDirectAnimation(this.wrapperNode,[e],0,180,!0,1)};